---
title: "PAX_EDA_database"
author: "Jose Luis Rivas Calduch"
date: "8/4/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, include=FALSE}

#Cargamos las diferentes librerias a emplear

#Lectura del fichero csv
library(readr)

#Lectura del fichero excel
library(readxl)

# Manejo de data frames
library(tidyverse)
library(tidyr)
library(pander)

#Libreria para representar gráficos
library(ggpubr)
library(ggplot2)

#Libreria para el manejo de datos
library(dplyr)
library(psych)

```

## Descripción del trabajo:

El presente *R Markdown* forma parte del trabajo realizado por José Luis Rivas Calduch como alumno de **Master en Ciencia de Datos** de la **UOC** para la asignatura **Visualización de Datos** en concreto para la PEC 2 del curso 20-21 en su segundo semestre.

En concreto se desarrolla la fase de análisis y exploración de los datos (*EDA*) objeto del trabajo anteriormente mencionado.

Cabe destacar que la base de datos (*Database*) *pax_all_agreements_data* ha sido elaborada por la profesora Christine Bell de la Universidad de Edimburgo y que su uso se encuentra regido por los siguientes términos contenidos en el enlace de a continuación: https://www.peaceagreements.org/files/Terms_of_Use.pdf

### Carga de los datos:

Como ya hemos indicado en el análisis preliminar de los datos inicialmente para este trabajo nos vamos a centrar en los primeros 26 atributos de la base de datos para su exploración.

```{r, echo=FALSE}

# Leemos los datos del dataset descargado

rawData <- read_excel("../data/pax_all_agreements_data.xlsx")

datos <- rawData[1:26]

str(datos)

```

se han identificado dentro del grupo seleccionado una serie de atributos categóricos que también se va a considerar su dejarlos fuera del análisis dado que cada registro es diferente al ser campos de texto libre ya que son descripciones. Dichos campos son:

* *Agt*: Nombre del acuerdo.
* *Part*: Firmantes del acuerdo.
* *ThrdPart*: Terceros firmantes del acuerdo.
* *OthAgr*: Otros acuerdos incluidos en el documento.

```{r}

datos <- select(datos,-Agt, -Part, -ThrdPart, -OthAgr)

```

### Limpieza de los datos:

Vamos a identificar la existencia de valores nulos (NA´s) o vacios en el datos set.

**Estadísticas de los valores nulos**

```{r}

colSums(is.na(datos))

```

Se han identificado 9 atributos que contienen valores nulos por lo que habrá que decirdir como tratarlos.

**Estadísticas de los valores cero o vacios**

```{r}

colSums(datos=="")

```

```{r}

colSums(datos==0)

```

No se identifican valores cero o vacios.

### Atributos categóricos:

#### *Con* Pais/Entidad:

Se observa que el atributo contiene gran cantidad de valores únicos.

* Número de valores únicos:

```{r}

length(unique(datos$Con))

```

Analizar el listado no se aprecia que podamos utilizar la columna para alguna visual dado que muchos de los valores esta compuesto por concatenación de paises o entidades y sería necesario tratar el atributo para su uso. Por lo que por el momento la descartamos.

#### *Contp* Tipo conflicto:

* Número de valores únicos:

```{r}

length(unique(datos$Contp))

```
* Diagrama de distribución:

```{r}

ggplot(data = datos, aes(x = Contp, y = ..count..)) +
  geom_bar() +
  labs(title = "Tipo de conflicto") +
  theme_bw() +
  theme(legend.position = "bottom")

```

* Tabla de frecuencias (#):

```{r}

table(datos$Contp)

```

* Tabla de frecuencias (%):

```{r}

prop.table(table(datos$Contp)) %>% round(digits = 2)

```

Se observa que la mayoría de los acuerdos están relacionados con conflictos gubernamentales (80%).

#### *PPName* Nombre proceso:

Se observa que el atributo contiene gran cantidad de valores únicos.

* Número de valores únicos:

```{r}

length(unique(datos$PPName))

```

Analizar el listado no se aprecia que podamos utilizar la columna para alguna visual dado que muchos de los valores esta compuesto por concatenación de paises o entidades y sería necesario tratar el atributo para su uso. Por lo que por el momento la descartamos.

#### *Reg* Región:

* Número de valores únicos:

```{r}

length(unique(datos$Reg))

```
* Diagrama de distribución:

```{r}

ggplot(data = datos, aes(x = Reg, y = ..count..)) +
  geom_bar() +
  labs(title = "Región") +
  theme_bw() +
  theme(legend.position = "bottom")

```

* Tabla de frecuencias (#):

```{r}

table(datos$Reg)

```

* Tabla de frecuencias (%):

```{r}

prop.table(table(datos$Reg)) %>% round(digits = 2)

```

Se observa que la mayoría de los acuerdos se concentran en Africa (45%).

#### *Status* Estado del acuerdo:

* Número de valores únicos:

```{r}

length(unique(datos$Status))

```
* Diagrama de distribución:

```{r}

ggplot(data = datos, aes(x = Status, y = ..count..)) +
  geom_bar() +
  labs(title = "Estado del acuerdo") +
  theme_bw() +
  theme(legend.position = "bottom")

```

* Tabla de frecuencias (#):

```{r}

table(datos$Status)

```

* Tabla de frecuencias (%):

```{r}

prop.table(table(datos$Status)) %>% round(digits = 2)

```

Se observa que la mayoría de los acuerdos se concentran se encuentran firmado por las diferentes partes (92%).

#### *Agtp* Tipo de acuerdo:

* Número de valores únicos:

```{r}

length(unique(datos$Agtp))

```
* Diagrama de distribución:

```{r}

ggplot(data = datos, aes(x = Agtp, y = ..count..)) +
  geom_bar() +
  labs(title = "Tipo de acuerdo") +
  theme_bw() +
  theme(legend.position = "bottom")

```

* Tabla de frecuencias (#):

```{r}

table(datos$Agtp)

```

* Tabla de frecuencias (%):

```{r}

prop.table(table(datos$Agtp)) %>% round(digits = 2)

```

Se observa que la mayoría de los acuerdos se concentran en conflictos dentro de los propios estados (83%).

#### *Stage* Etapa:

* Número de valores únicos:

```{r}

length(unique(datos$Stage))

```
* Diagrama de distribución:


```{r}

ggplot(data = datos, aes(x = Stage, y = ..count..)) +
  geom_bar() +
  labs(title = "Etapa del acuerdo") +
  theme_bw() +
  theme(legend.position = "bottom")

```


* Tabla de frecuencias (#):

```{r}

table(datos$Stage)

```

* Tabla de frecuencias (%):

```{r}

prop.table(table(datos$Stage)) %>% round(digits = 2)

```

#### *StageSub* Subestapa del acuerdo:

Dado que se considera que los atributos *Stage* y *StageSub* se encuentran ligados se cree apropiado que se analicen ambos en combinación creando un atributo sintético con su concatenado.

```{r}

datos <- unite(datos, stage_sintetico, c('Stage','StageSub'), sep = "&", remove=FALSE)

```

* Número de valores únicos:

```{r}

length(unique(datos$stage_sintetico))

```
* Diagrama de distribución:

```{r}

ggplot(data = datos, aes(x = stage_sintetico, y = ..count..)) +
  geom_bar() +
  labs(title = "Agptión") +
  theme_bw() +
  theme(legend.position = "bottom")

```

* Tabla de frecuencias (#):

```{r}

table(datos$stage_sintetico)

```

* Tabla de frecuencias (%):

```{r}

prop.table(table(datos$stage_sintetico)) %>% round(digits = 2)

```

Se observa que la mayoría de los acuerdos se concentran en conflictos dentro de los propios estados (83%).
